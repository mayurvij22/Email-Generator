<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Job Email Generator</title>
    <link rel="icon" href="https://cdn.jsdelivr.net/gh/twitter/twemoji/assets/svg/2709.svg">
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body
    class="bg-gradient-to-br from-indigo-50 to-violet-200 min-h-screen font-sans flex items-center justify-center antialiased">

    <div class="w-full max-w-2xl mx-auto md:px-0 px-2 py-8">
        <div
            class="bg-white shadow-2xl rounded-3xl px-8 py-10 flex flex-col gap-y-8 relative overflow-hidden ring-1 ring-violet-100">
            <div class="absolute -right-20 -top-28 bg-violet-100 w-72 h-72 rounded-full z-0 blur-2xl opacity-60"></div>
            <h2
                class="z-10 relative text-3xl md:text-4xl font-extrabold text-center bg-gradient-to-r from-violet-700 to-indigo-600 bg-clip-text text-transparent drop-shadow-2xl">
                <span>âœ‰ï¸ AI Job Email Generator</span>
            </h2>
            <p class="z-10 relative text-center text-base md:text-lg text-gray-500 font-medium mb-3">
                Generate polished, job-ready emails with just a few details. <span class="hidden md:inline">Confident.
                    Professional. Instant.</span>
            </p>

            <form id="emailForm" class="z-10 space-y-4">
                <!-- Personal Applicant Data -->
                <div class="flex gap-2 flex-col md:flex-row">
                    <input type="text" id="name" placeholder="Your Full Name *" autocomplete="name"
                        class="flex-1 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-violet-500 focus:outline-none text-gray-800 font-medium placeholder-gray-400"
                        required />
                    <input type="email" id="userEmail" placeholder="Your Email *"
                        class="flex-1 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-violet-500 focus:outline-none text-gray-800 placeholder-gray-400"
                        required />
                </div>
                <div class="flex gap-2 flex-col md:flex-row">
                    <input type="text" id="userPhone" placeholder="Your Phone"
                        class="flex-1 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-violet-500 focus:outline-none text-gray-800 placeholder-gray-400" />
                    <input type="text" id="location" placeholder="Location (e.g. Bangalore, India)"
                        class="flex-1 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-violet-500 focus:outline-none text-gray-800 placeholder-gray-400" />
                </div>

                <!-- Job and HR Details -->
                <div class="flex gap-2 flex-col md:flex-row">
                    <input type="text" id="hrName" placeholder="HR Name (e.g. Ms. Priya Singh)"
                        class="flex-1 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-violet-500 focus:outline-none text-gray-800 placeholder-gray-400" />
                    <input type="email" id="hrEmail" placeholder="HR Email *"
                        class="flex-1 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-violet-500 focus:outline-none text-gray-800 placeholder-gray-400"
                        required />
                </div>
                <div class="flex gap-2 flex-col md:flex-row">
                    <input type="text" id="company" placeholder="Company Name (optional)"
                        class="flex-1 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-violet-500 focus:outline-none text-gray-800 placeholder-gray-400" />
                    <input type="text" id="companyPhone" placeholder="Company Phone"
                        class="flex-1 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-violet-500 focus:outline-none text-gray-800 placeholder-gray-400" />
                </div>
                <div class="flex gap-2 flex-col md:flex-row">
                    <input type="text" id="jobRole" placeholder="Job Role * (e.g. Frontend Developer)"
                        autocomplete="off"
                        class="flex-1 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-violet-500 focus:outline-none text-gray-800 placeholder-gray-400"
                        required />
                    <input type="text" id="education" placeholder="Education (e.g. B.Tech in CSE)"
                        class="flex-1 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-violet-500 focus:outline-none text-gray-800 placeholder-gray-400" />
                </div>
                <input type="text" id="skills" placeholder="Skills (comma separated, e.g. React, Node.js, Java)"
                    class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-violet-500 focus:outline-none text-gray-800 placeholder-gray-400" />

                <details class="block bg-violet-50 p-3 rounded-lg mt-1 group">
                    <summary
                        class="cursor-pointer font-semibold text-violet-700 select-none flex items-center gap-1 text-sm">
                        <span class="material-icons text-base">expand_more</span>
                        Advanced: Paste Job Details / Message
                    </summary>
                    <textarea id="rawData" placeholder="Paste raw job posting, message, or info (optional)" rows="3"
                        class="mt-2 w-full border border-gray-200 rounded-lg p-3 focus:ring-2 focus:ring-violet-500 focus:outline-none text-gray-700 font-medium resize-none placeholder-gray-400"></textarea>
                </details>

                <button type="submit" id="submitBtn"
                    class="w-full py-3 bg-gradient-to-r from-indigo-600 via-violet-600 to-pink-500 shadow-lg text-white rounded-xl font-semibold text-lg hover:scale-105 transition-transform focus:outline-none flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                    <span id="submitIcon">ğŸš€</span>
                    <span id="submitText">Generate Email</span>
                </button>
                <div id="progressBar" class="h-1 w-full bg-violet-100 rounded-full overflow-hidden hidden">
                    <div class="bg-gradient-to-r from-violet-400 to-pink-400 h-full w-1/2 animate-pulse"></div>
                </div>
            </form>

            <div id="resultContainer" class="hidden z-10 mt-6">
                <div class="flex items-center gap-2 mb-3">
                    <span class="material-icons text-violet-600">mail</span>
                    <h3 class="text-lg font-bold text-gray-800">Generated Email</h3>
                </div>
                <div
                    class="bg-violet-50 border border-violet-200 rounded-lg p-3 text-sm text-violet-900 mb-1 flex items-center gap-2">
                    <span class="font-bold">Subject:</span>
                    <span id="subjectText" class="font-mono"></span>
                </div>
                <pre id="bodyText"
                    class="bg-gray-100 p-4 rounded-lg text-sm text-gray-800 mb-3 whitespace-pre-wrap border border-gray-200"></pre>
                <details class="mt-2">
                    <summary class="cursor-pointer text-xs text-gray-500">Show raw JSON output</summary>
                    <pre id="outputRaw"
                        class="bg-gray-50 mt-2 p-2 rounded-lg text-xs text-gray-700 max-h-60 overflow-auto"></pre>
                </details>
                <div class="grid grid-cols-2 gap-3 mt-4">
                    <button id="copySubjectBtn"
                        class="bg-blue-500 text-white py-2 rounded-lg font-medium hover:bg-blue-600 transition">
                        ğŸ“‹ Copy Subject
                    </button>
                    <button id="copyBodyBtn"
                        class="bg-green-500 text-white py-2 rounded-lg font-medium hover:bg-green-600 transition">
                        ğŸ“‹ Copy Body
                    </button>
                </div>
            </div>

            <div id="errorMsg"
                class="hidden text-sm text-red-800 bg-red-50 border border-red-200 rounded-lg px-4 py-3 my-2 font-semibold text-center">
            </div>
            <p id="hintMsg" class="mt-1 text-xs text-gray-400 text-center">
                Tip: Review, personalize, and proofread the generated email before sending.<br>
                Replace placeholders like â€œthe companyâ€ with actual names. For best results, fill all fields.
            </p>
        </div>
    </div>

    <script>
        const form = document.getElementById("emailForm");
        const submitBtn = document.getElementById("submitBtn");
        const submitIcon = document.getElementById("submitIcon");
        const submitText = document.getElementById("submitText");
        const progressBar = document.getElementById("progressBar");

        const resultContainer = document.getElementById("resultContainer");
        const subjectText = document.getElementById("subjectText");
        const bodyText = document.getElementById("bodyText");
        const outputRaw = document.getElementById("outputRaw");
        const errorMsg = document.getElementById("errorMsg");

        const copySubjectBtn = document.getElementById("copySubjectBtn");
        const copyBodyBtn = document.getElementById("copyBodyBtn");

        function setLoading(isLoading) {
            submitBtn.disabled = isLoading;
            submitIcon.textContent = isLoading ? 'â³' : 'ğŸš€';
            submitText.textContent = isLoading ? "Generating..." : "Generate Email";
            progressBar.classList.toggle('hidden', !isLoading);
        }

        function showError(message) {
            errorMsg.textContent = message;
            errorMsg.classList.remove("hidden");
            resultContainer.classList.add("hidden");
        }

        function clearError() {
            errorMsg.textContent = "";
            errorMsg.classList.add("hidden");
        }

        function ensureEmailString(val) {
            return typeof val === "string" ? val : (val == null ? "" : String(val));
        }

        function toHumanEmail(data) {
            const generated = data && data.generated ? data.generated : {};
            const subject = ensureEmailString(generated.subject || "");
            const body = ensureEmailString(generated.body || "");
            return { subject, body };
        }

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            clearError();

            // Grab all field values for POST body
            const name = document.getElementById("name").value.trim();
            const userEmail = document.getElementById("userEmail").value.trim();
            const userPhone = document.getElementById("userPhone").value.trim();
            const location = document.getElementById("location").value.trim();
            const hrName = document.getElementById("hrName").value.trim();
            const hrEmail = document.getElementById("hrEmail").value.trim();
            const jobRole = document.getElementById("jobRole").value.trim();
            const company = document.getElementById("company").value.trim();
            const companyPhone = document.getElementById("companyPhone").value.trim();
            const education = document.getElementById("education").value.trim();
            const skills = document.getElementById("skills").value.trim();
            const rawData = document.getElementById("rawData").value.trim();

            if (!name || !hrEmail || !userEmail || !jobRole) {
                showError("Please fill in required fields: Name, Your Email, HR Email, and Job Role.");
                return;
            }

            setLoading(true);
            resultContainer.classList.remove("hidden");
            subjectText.textContent = "";
            bodyText.textContent = "â³ Generating email...";
            outputRaw.textContent = "";

            try {
                const postData = {
                    name, userEmail, userPhone, location,
                    hrName, hrEmail, jobRole,
                    company, companyPhone,
                    education, skills,
                    rawData
                };

                const res = await fetch("http://localhost:5000/api/email/generate", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(postData)
                });

                if (!res.ok) {
                    const errText = await res.text().catch(() => "");
                    throw new Error(`Server error (${res.status}): ${errText || "Unexpected response"}`);
                }
                const data = await res.json();
                outputRaw.textContent = JSON.stringify(data, null, 2);
                const { subject, body } = toHumanEmail(data);

                const safeSubject = subject || `Application for ${jobRole} â€“ ${name}`;
                const safeBody =
                    body ||
                    `Dear Hiring Manager,\n\nI am writing to express my interest in the ${jobRole}${company ? " role at " + company : ""}.\n\nThank you for your time and consideration.\n\nSincerely,\n${name}`;

                subjectText.textContent = safeSubject;
                bodyText.textContent = safeBody;

            } catch (err) {
                showError("Failed to generate email: " + err.message);
                bodyText.textContent = "";
            } finally {
                setLoading(false);
            }
        });

        copySubjectBtn.addEventListener("click", async () => {
            try {
                await navigator.clipboard.writeText(subjectText.textContent || "");
                copySubjectBtn.textContent = "âœ… Copied!";
            } catch {
                copySubjectBtn.textContent = "âŒ Copy failed";
            } finally {
                setTimeout(() => (copySubjectBtn.textContent = "ğŸ“‹ Copy Subject"), 1800);
            }
        });

        copyBodyBtn.addEventListener("click", async () => {
            try {
                await navigator.clipboard.writeText(bodyText.textContent || "");
                copyBodyBtn.textContent = "âœ… Copied!";
            } catch {
                copyBodyBtn.textContent = "âŒ Copy failed";
            } finally {
                setTimeout(() => (copyBodyBtn.textContent = "ğŸ“‹ Copy Body"), 1800);
            }
        });
    </script>
    <!-- Material Icons for subtle iconography -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</body>

</html>